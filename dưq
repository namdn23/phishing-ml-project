import pandas as pd
import numpy as np

# --- C·∫§U H√åNH ---
FILE_PATH = 'dataset_final_train.csv' 

def report_quality():
    print(f"üßê ƒêANG SOI CHI TI·∫æT B·ªò D·ªÆ LI·ªÜU: {FILE_PATH}")
    print("="*60)

    try:
        df = pd.read_csv(FILE_PATH)
    except Exception as e:
        print(f"‚ùå Kh√¥ng m·ªü ƒë∆∞·ª£c file: {e}")
        return

    total = len(df)
    
    # 1. Ki·ªÉm tra Nh√£n
    l_counts = df['label'].value_counts()
    print(f"üìà 1. C√ÇN B·∫∞NG NH√ÉN:")
    print(f"   - S·∫°ch (0):   {l_counts.get(0, 0):,} d√≤ng")
    print(f"   - L·ª´a ƒë·∫£o (1): {l_counts.get(1, 0):,} d√≤ng")
    print("-" * 30)

    # 2. Ki·ªÉm tra SSL (Nh√≥m h·∫° t·∫ßng)
    # L·ªói SSL th∆∞·ªùng tr·∫£ v·ªÅ -1
    ssl_fail = len(df[df['Certificate_Age'] == -1])
    ssl_ok = total - ssl_fail
    print(f"üõ°Ô∏è 2. CH·∫§T L∆Ø·ª¢NG SSL:")
    print(f"   - ‚úÖ L·∫•y ƒë∆∞·ª£c th√¥ng tin: {ssl_ok:,} ({ssl_ok/total*100:.1f}%)")
    print(f"   - ‚ùå B·ªã l·ªói (-1):        {ssl_fail:,} ({ssl_fail/total*100:.1f}%)")
    print("-" * 30)

    # 3. Ki·ªÉm tra HTML (Nh√≥m n·ªôi dung)
    # N·∫øu tr√≠ch xu·∫•t th·∫•t b·∫°i, c√°c c·ªôt n√†y th∆∞·ªùng ƒë·ªÅu l√† 0
    html_cols = ['Has_External_Form', 'Has_Submit_Button', 'Has_Password_Field', 'Brand_Impersonation']
    # M·ªôt d√≤ng b·ªã coi l√† "M√π HTML" n·∫øu t·∫•t c·∫£ c√°c c·ªôt n·ªôi dung ƒë·ªÅu l√† 0
    html_fail_mask = (df[html_cols] == 0).all(axis=1)
    html_fail_count = html_fail_mask.sum()
    html_ok = total - html_fail_count
    print(f"üåê 3. CH·∫§T L∆Ø·ª¢NG N·ªòI DUNG (HTML):")
    print(f"   - ‚úÖ L·∫•y ƒë∆∞·ª£c n·ªôi dung: {html_ok:,} ({html_ok/total*100:.1f}%)")
    print(f"   - ‚ùå Kh√¥ng l·∫•y ƒë∆∞·ª£c (0): {html_fail_count:,} ({html_fail_count/total*100:.1f}%)")
    print("-" * 30)

    # 4. Ph√¢n lo·∫°i "S·ª©c kh·ªèe" c·ªßa t·ª´ng d√≤ng
    # D√≤ng "V√†ng": C√≥ c·∫£ SSL v√† HTML
    gold = len(df[(df['Certificate_Age'] != -1) & (~html_fail_mask)])
    # D√≤ng "B·∫°c": Ch·ªâ c√≥ SSL ho·∫∑c ch·ªâ c√≥ HTML
    silver = len(df[((df['Certificate_Age'] != -1) & (html_fail_mask)) | ((df['Certificate_Age'] == -1) & (~html_fail_mask))])
    # D√≤ng "R√°c": C·∫£ hai ƒë·ªÅu l·ªói (Ch·ªâ c√≤n m·ªói 15 feature c·∫•u tr√∫c URL ƒë·ªÉ h·ªçc)
    trash = len(df[(df['Certificate_Age'] == -1) & (html_fail_mask)])

    print(f"üíé 4. PH√ÇN LO·∫†I D·ªÆ LI·ªÜU ƒê·ªÇ TRAIN:")
    print(f"   - ü•á Lo·∫°i V√†ng (C·ª±c t·ªët): {gold:,} d√≤ng")
    print(f"   - ü•à Lo·∫°i B·∫°c (T·∫°m ·ªïn): {silver:,} d√≤ng")
    print(f"   - ü•â Lo·∫°i R√°c (C·ª±c y·∫øu): {trash:,} d√≤ng (N√™n c√¢n nh·∫Øc x√≥a)")
    print("="*60)

    print("\nüí° L·ªúI KHUY√äN:")
    if trash / total > 0.5:
        print("‚ö†Ô∏è  C·∫¢NH B√ÅO: H∆°n 50% d·ªØ li·ªáu c·ªßa b·∫°n l√† 'R√°c'.")
        print("   Model s·∫Ω ch·ªâ h·ªçc d·ª±a tr√™n c·∫•u tr√∫c URL, ƒë·ªô ch√≠nh x√°c th·ª±c t·∫ø s·∫Ω kh√¥ng cao.")
    else:
        print("‚úÖ B·ªô d·ªØ li·ªáu kh√° ·ªïn. B·∫°n c√≥ th·ªÉ ti·∫øn h√†nh x·ª≠ l√Ω h·∫≠u k·ª≥ v√† Train.")

if __name__ == "__main__":
    report_quality()
