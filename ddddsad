import pandas as pd
import numpy as np
import os

# --- C·∫§U H√åNH ---
INPUT_FILE = 'dataset_final_train.csv'  # File v·ª´a tr√≠ch xu·∫•t xong

def check_quality():
    print(f"üïµÔ∏è‚Äç‚ôÇÔ∏è ƒêang ki·ªÉm tra ch·∫•t l∆∞·ª£ng file: {INPUT_FILE}")
    print("-" * 50)
    
    if not os.path.exists(INPUT_FILE):
        print(f"‚ùå L·ªói: Kh√¥ng t√¨m th·∫•y file '{INPUT_FILE}'")
        return

    try:
        # 1. ƒê·ªçc file
        df = pd.read_csv(INPUT_FILE)
        
        # 2. Ki·ªÉm tra k√≠ch th∆∞·ªõc
        n_rows, n_cols = df.shape
        print(f"üìä K√≠ch th∆∞·ªõc: {n_rows:,} d√≤ng, {n_cols} c·ªôt")
        
        # 3. Ki·ªÉm tra c·ªôt URL (N√™n c√≥ ƒë·ªÉ debug, nh∆∞ng ph·∫£i drop khi train)
        if 'url' in df.columns:
            print("‚ÑπÔ∏è  C·ªôt 'url': C√ì (S·∫Ω c·∫ßn b·ªè c·ªôt n√†y khi train)")
            # T·∫°m th·ªùi b·ªè c·ªôt url ra ƒë·ªÉ check c√°c feature s·ªë
            df_numeric = df.drop(columns=['url'])
        else:
            print("‚ÑπÔ∏è  C·ªôt 'url': KH√îNG (D·ªØ li·ªáu ƒë√£ s·∫°ch, s·∫µn s√†ng train)")
            df_numeric = df

        # 4. Ki·ªÉm tra d·ªØ li·ªáu r·ªóng (Null/NaN)
        null_counts = df_numeric.isnull().sum().sum()
        if null_counts > 0:
            print(f"‚ùå C·∫¢NH B√ÅO: C√≥ {null_counts} √¥ b·ªã r·ªóng (NaN)!")
            print("   -> B·∫°n c·∫ßn ƒëi·ªÅn s·ªë 0 ho·∫∑c x√≥a c√°c d√≤ng n√†y tr∆∞·ªõc khi train.")
            # Show c·ªôt n√†o b·ªã null
            print(df_numeric.isnull().sum()[df_numeric.isnull().sum() > 0])
        else:
            print("‚úÖ D·ªØ li·ªáu r·ªóng (Null): 0 (S·∫°ch bong!)")

        # 5. Ki·ªÉm tra ki·ªÉu d·ªØ li·ªáu (Ph·∫£i l√† s·ªë h·∫øt)
        non_numeric_cols = df_numeric.select_dtypes(exclude=[np.number]).columns
        if len(non_numeric_cols) > 0:
            print(f"‚ùå C·∫¢NH B√ÅO: C√°c c·ªôt sau kh√¥ng ph·∫£i l√† s·ªë: {list(non_numeric_cols)}")
            print("   -> Model kh√¥ng train ƒë∆∞·ª£c text. H√£y ki·ªÉm tra l·∫°i code tr√≠ch xu·∫•t.")
        else:
            print("‚úÖ Ki·ªÉu d·ªØ li·ªáu: To√†n b·ªô l√† S·ªê (Chu·∫©n!)")

        # 6. Ki·ªÉm tra Label (Quan tr·ªçng nh·∫•t)
        if 'label' in df.columns:
            print("\n‚öñÔ∏è  PH√ÇN B·ªê NH√ÉN (LABEL):")
            val_counts = df['label'].value_counts()
            print(val_counts)
            
            # Check xem label c√≥ ph·∫£i 0 v√† 1 kh√¥ng
            unique_labels = df['label'].unique()
            if set(unique_labels) <= {0, 1}:
                 print("‚úÖ Label chu·∫©n: Ch·ªâ ch·ª©a 0 v√† 1.")
            else:
                 print(f"‚ùå C·∫£nh b√°o Label: Ch·ª©a gi√° tr·ªã l·∫° {unique_labels} (Ph·∫£i map v·ªÅ 0/1)")
        else:
            print("‚ùå L·ªói: Kh√¥ng t√¨m th·∫•y c·ªôt 'label'!")

        # 7. Check s∆° b·ªô c√°c Feature quan tr·ªçng
        print("\nüîç CHECK NHANH GI√Å TR·ªä C√ÅC FEATURE M·ªöI:")
        cols_to_check = ['Google_DOM_Signature', 'Is_Trusted_Issuer', 'Has_Obfuscated_JS', 'Is_Punycode']
        for col in cols_to_check:
            if col in df.columns:
                has_data = df[col].sum()
                print(f"   - {col}: C√≥ {has_data} d√≤ng ƒë∆∞·ª£c k√≠ch ho·∫°t (=1)")
            else:
                print(f"   - {col}: ‚ö†Ô∏è Kh√¥ng t√¨m th·∫•y c·ªôt n√†y!")

    except Exception as e:
        print(f"‚ùå L·ªói khi ƒë·ªçc file: {e}")

if __name__ == "__main__":
    check_quality()
