import pandas as pd
import numpy as np
import os

# --- Cáº¤U HÃŒNH ---
INPUT_FILE = 'dataset_final_train.csv'

def analyze_all_features():
    print(f"ğŸ”¬ ÄANG PHÃ‚N TÃCH TOÃ€N Bá»˜ FEATURE TRONG: {INPUT_FILE}")
    print("=" * 60)

    if not os.path.exists(INPUT_FILE):
        print("âŒ Lá»—i: KhÃ´ng tÃ¬m tháº¥y file csv!")
        return

    df = pd.read_csv(INPUT_FILE)
    
    # TÃ¡ch riÃªng label vÃ  url (náº¿u cÃ³)
    features_df = df.drop(columns=['label', 'url'], errors='ignore')
    label_col = df['label'] if 'label' in df.columns else None
    
    print(f"ğŸ“Š Tá»•ng sá»‘ dÃ²ng: {len(df)}")
    print(f"ğŸ§© Tá»•ng sá»‘ feature: {len(features_df.columns)}")
    print("-" * 60)

    # 1. PHÃ‚N TÃCH CHI TIáº¾T Tá»ªNG FEATURE
    print(f"{'FEATURE NAME':<25} | {'TYPE':<10} | {'STATS / DISTRIBUTION'}")
    print("-" * 80)

    for col in features_df.columns:
        col_data = features_df[col]
        unique_vals = col_data.unique()
        n_unique = len(unique_vals)
        
        # A. Náº¿u lÃ  feature dáº¡ng Binary (chá»‰ cÃ³ 0, 1 hoáº·c -1)
        if n_unique <= 5: 
            type_str = "BINARY"
            # Äáº¿m giÃ¡ trá»‹
            counts = col_data.value_counts().to_dict()
            stat_str = ", ".join([f"{k}: {v}" for k, v in counts.items()])
        
        # B. Náº¿u lÃ  feature dáº¡ng Sá»‘ Ä‘o (Length, Ratio, Entropy...)
        else:
            type_str = "NUMERIC"
            min_val = col_data.min()
            max_val = col_data.max()
            mean_val = col_data.mean()
            stat_str = f"Min: {min_val:.2f} | Max: {max_val:.2f} | Avg: {mean_val:.2f}"
            
        print(f"{col:<25} | {type_str:<10} | {stat_str}")

    # 2. KIá»‚M TRA Äá»˜ QUAN TRá»ŒNG (CORRELATION)
    if label_col is not None:
        print("\n" + "=" * 60)
        print("ğŸŒŸ Äá»˜ TÆ¯Æ NG QUAN Vá»šI NHÃƒN PHISHING (LABEL)")
        print("(Sá»‘ cÃ ng gáº§n 1 hoáº·c -1 thÃ¬ Feature cÃ ng xá»‹n. Gáº§n 0 lÃ  vÃ´ dá»¥ng)")
        print("-" * 60)
        
        correlations = features_df.corrwith(label_col).sort_values(ascending=False)
        
        print(f"{'Feature':<25} | {'Correlation Score'}")
        print("-" * 45)
        for feat, score in correlations.items():
            stars = "â­" * int(abs(score) * 5) # ÄÃ¡nh giÃ¡ sao
            print(f"{feat:<25} | {score: .4f} {stars}")

if __name__ == "__main__":
    analyze_all_features()
