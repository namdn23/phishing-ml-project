import pandas as pd
import os

# --- Cáº¤U HÃŒNH ---
INPUT_FILE = 'dataset_combined_v2.csv'  # File Ä‘áº§u vÃ o cá»§a báº¡n
OUTPUT_FILE = 'datakieumoi.csv' # File sau khi Ä‘Ã£ cÃ¢n báº±ng

def main():
    print(f"ğŸ“‚ Äang Ä‘á»c file: {INPUT_FILE}")
    if not os.path.exists(INPUT_FILE):
        print("âŒ KhÃ´ng tÃ¬m tháº¥y file Ä‘áº§u vÃ o!")
        return

    # 1. Load dá»¯ liá»‡u
    df = pd.read_csv(INPUT_FILE)
    
    # 2. TÃ¡ch riÃªng 2 lá»›p dá»±a trÃªn label (Ä‘áº£m báº£o label lÃ  kiá»ƒu string hoáº·c sá»‘ khá»›p vá»›i file)
    # Trong file cá»§a báº¡n label Ä‘ang lÃ  0 vÃ  1
    df_phishing = df[df['label'].astype(str) == '1']
    df_legit = df[df['label'].astype(str) == '0']
    
    num_phishing = len(df_phishing)
    num_legit_total = len(df_legit)
    
    print(f"ğŸ“Š Dá»¯ liá»‡u hiá»‡n táº¡i:")
    print(f"   - Phishing (1): {num_phishing:,} dÃ²ng")
    print(f"   - Legit (0):    {num_legit_total:,} dÃ²ng")
    
    # 3. Lá»c (Downsampling) lá»›p Legit
    # á» Ä‘Ã¢y mÃ¬nh láº¥y sá»‘ lÆ°á»£ng Legit Báº°NG sá»‘ lÆ°á»£ng Phishing (Tá»· lá»‡ 1:1)
    # Báº¡n cÃ³ thá»ƒ thay n=num_phishing báº±ng má»™t con sá»‘ cá»¥ thá»ƒ náº¿u muá»‘n
    print(f"\nâš–ï¸ Äang thá»±c hiá»‡n cÃ¢n báº±ng tá»· lá»‡ 1:1...")
    df_legit_balanced = df_legit.sample(n=num_phishing, random_state=42)
    
    # 4. Gá»™p láº¡i vÃ  trá»™n ngáº«u nhiÃªn (Shuffle)
    df_final = pd.concat([df_phishing, df_legit_balanced])
    df_final = df_final.sample(frac=1, random_state=42).reset_index(drop=True)
    
    # 5. LÆ°u káº¿t quáº£
    df_final.to_csv(OUTPUT_FILE, index=False)
    
    print("-" * 50)
    print(f"âœ… HOÃ€N Táº¤T CÃ‚N Báº°NG!")
    print(f"   - Sá»‘ lÆ°á»£ng Legit má»›i:    {len(df_legit_balanced):,}")
    print(f"   - Sá»‘ lÆ°á»£ng Phishing giá»¯: {len(df_phishing):,}")
    print(f"ğŸ‘‰ Tá»•ng cá»™ng file má»›i:      {len(df_final):,}")
    print(f"ğŸ’¾ ÄÃ£ lÆ°u táº¡i:              {OUTPUT_FILE}")
    print("-" * 50)
    print("ğŸš€ Tiáº¿p theo: DÃ¹ng file nÃ y Ä‘á»ƒ cháº¡y tool 'TrÃ­ch xuáº¥t 27 Features'!")

if __name__ == "__main__":
    main()
