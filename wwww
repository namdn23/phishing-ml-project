import pandas as pd
import numpy as np
import os

INPUT_CSV_FILE = 'merged_extracted_data_final_processed.csv'
# Hoặc tên file cuối cùng sau khi đã lọc: 'final_selected_features.csv'

def check_file_integrity(file_path):
    if not os.path.exists(file_path):
        print(f"❌ Lỗi: Không tìm thấy file đầu vào: {file_path}")
        return

    try:
        df = pd.read_csv(file_path)
    except Exception as e:
        print(f"❌ Lỗi khi đọc file CSV: {e}")
        return

    print(f"--- Đã đọc thành công {len(df)} dòng dữ liệu ---")

    # 1. KIỂM TRA TỶ LỆ CÁC GIÁ TRỊ CỐ ĐỊNH (0, 1, 0.5)
    print("\n--- 1. Tỷ lệ các giá trị cố định (0, 1, 0.5) ---")
    fixed_values = [0, 1, 0.5]
    for col in df.columns:
        # Bỏ qua cột URL và các cột liên tục lớn
        if col in ['url', 'V3_Domain_Age_Days', 'NoOfDegitsInURL']:
            continue
        
        # Đếm tỷ lệ 0.5 (để phát hiện lỗi trích xuất)
        count_0_5 = (df[col] == 0.5).sum()
        if count_0_5 > 0:
            print(f"   ⚠️ {col}: {count_0_5 / len(df) * 100:.2f}% giá trị là 0.5 (Lỗi/Timeout Playwright)")
        
        # Đếm tỷ lệ 0 và 1 cho các cột nhị phân
        if df[col].isin(fixed_values).all():
            count_0 = (df[col] == 0).sum()
            print(f"   ✅ {col}: {count_0 / len(df) * 100:.2f}% là 0. Tỷ lệ còn lại là 1.")


    # 2. BÁO CÁO THỐNG KÊ MÔ TẢ (DESCRIPTIVE STATISTICS)
    # Rất quan trọng để kiểm tra các feature liên tục
    print("\n--- 2. Báo cáo Thống kê Mô tả cho Feature Liên tục ---")
    
    # Chỉ chọn các cột liên tục quan trọng
    continuous_cols = ['V1_PHash_Distance', 'V2_Layout_Similarity', 'V3_Domain_Age_Days',
                       'V4_DNS_Volatility_Count', 'V6_JS_Entropy', 'V7_Text_Readability_Score']

    # Thêm các cột nhị phân khác để kiểm tra Max/Min
    other_checks = [col for col in df.columns if col not in continuous_cols and df[col].dtype != 'object']
    
    selected_cols = [col for col in (continuous_cols + other_checks) if col in df.columns]

    # In ra báo cáo thống kê
    stats = df[selected_cols].describe().T.round(4)
    
    # In ra toàn bộ báo cáo để tôi phân tích
    print("\n" + stats.to_string())

# --- THAY ĐỔI TÊN FILE CỦA BẠN NẾU CẦN ---
check_file_integrity(INPUT_CSV_FILE)
